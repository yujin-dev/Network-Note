# MySQL Documentation

[MySQL 공식문서](https://dev.mysql.com/doc/internals/en/)

## binary log
binary log는 MySQL 서버 인스턴스의 데이터 수정에 대한 정보를 기록한 로그 파일이다.
- 서버 상태
- 오류 코드
- binary log 자체 유지 관리를 위한 메타 데이터

다음과 같은 objective가 있다.
- Replicate 에서 master 서버에서 복제한 slave서버로 보낼 명령문의 기록을 위함. slave는 master로부터 받은 이벤트를 실행할 수 있을 때까지 relaylog에 저장
- 특정 데이터 복구 작업에 사용함. 백업 파일이 복원되면 이후에 로그에 기록된 이벤트가 다시 실행됨

2가지 유형이 있다.
- 명령문 기반 : 데이터 insert, update, delete포함 
- 행 기반 : 개별 행의 변경 사항 설명

### 구조
- 로그는 binary log 파일 + 인덱스 파일로 구성
- binary log는 `HOSTNAME-bin.0000101`와 같은 형식으로 생성되고 relaylog는 `HOSTNAME-relay.0000101`형식

### 이벤트
내부적으로 서버는 C++ 클래스로 로그 이벤트를 나타낸다. Byte 시퀀스는 데이터 헤더 + 데이터 이벤트로 되어 있다.

이벤트 구조는 가장 최신 기준으로 아래와 같이 구성된다. `offset` : `length` 형식으로 각 필드가 구성된다.
```
+=====================================+
| event  | timestamp         0 : 4    |
| header +----------------------------+
|        | type_code         4 : 1    |
|        +----------------------------+
|        | server_id         5 : 4    |
|        +----------------------------+
|        | event_length      9 : 4    |
|        +----------------------------+
|        | next_position    13 : 4    |
|        +----------------------------+
|        | flags            17 : 2    |
|        +----------------------------+
|        | extra_headers    19 : x-19 |  --> 헤더에 필드를 추가하기 위함
+=====================================+
| event  | fixed part        x : y    |
| data   +----------------------------+
|        | variable part              |
+=====================================+
```

#### 헤더 필드

